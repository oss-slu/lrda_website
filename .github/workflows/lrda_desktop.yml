name: lrda_desktop CI

on:
  push:
    branches:
      - main # replace with the name of your default branch if different
      - openai_tags
      - memoryleak
      - december-sprint
  pull_request:
    branches:
      - main # replace with the name of your default branch if different
      - openai_tags
      - memoryleak
      - december-sprint

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x] # Adjust according to your project's Node.js version

    steps:
      - uses: actions/checkout@v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node-version }}
      - name: Install pnpm
        run: npm install -g pnpm@8.11.0
      - name: Install dependencies
        run: pnpm install
      - name: Install Playwright browsers
        run: pnpm exec playwright install --with-deps
      - name: Build application
        run: pnpm build
        env:
          # Mock environment variables for build
          NEXT_PUBLIC_FIREBASE_API_KEY: "mock-api-key-for-ci"
          NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: "mock-domain.firebaseapp.com"
          NEXT_PUBLIC_FIREBASE_PROJECT_ID: "mock-project-id"
          NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: "mock-project.appspot.com"
          NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: "123456789"
          NEXT_PUBLIC_FIREBASE_APP_ID: "1:123456789:web:abcdef"
          NEXT_PUBLIC_RERUM_PREFIX: "https://store.rerum.io/v1"
          NEXT_PUBLIC_OPENAI_API_KEY: "mock-openai-key"
          NEXT_PUBLIC_OPENAI_API_URL: "https://api.openai.com/v1"
      - name: Run tests
        run: pnpm test
        env:
          # Mock environment variables for CI
          NEXT_PUBLIC_FIREBASE_API_KEY: "mock-api-key-for-ci"
          NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: "mock-domain.firebaseapp.com"
          NEXT_PUBLIC_FIREBASE_PROJECT_ID: "mock-project-id"
          NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: "mock-project.appspot.com"
          NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: "123456789"
          NEXT_PUBLIC_FIREBASE_APP_ID: "1:123456789:web:abcdef"
          NEXT_PUBLIC_RERUM_PREFIX: "https://store.rerum.io/v1"
          NEXT_PUBLIC_OPENAI_API_KEY: "mock-openai-key"
          NEXT_PUBLIC_OPENAI_API_URL: "https://api.openai.com/v1"
